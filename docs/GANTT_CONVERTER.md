# 甘特图转 draw.io 工具使用指南

## 📖 简介

`gantt_to_drawio.py` 是一个将项目进度甘特图表信息转换为 draw.io 可识别 XML 文件的工具。它可以将表格格式的项目进度数据自动转换为可视化的甘特图。

## ✨ 功能特性

- ✅ 解析表格格式的甘特图数据（支持制表符或空格分隔）
- ✅ 自动识别任务层级（根据任务ID的点号数量）
- ✅ 支持多种时间格式（M0, M1, M1+0.5, M1.5等）
- ✅ 智能处理超长任务（超过12个月的任务使用虚线边框）
- ✅ 自动优化时间轴显示（根据跨度自动调整刻度间隔）
- ✅ **独立备注列**：责任方/备注信息单独显示在任务名称后的独立列中，不混在任务条内
- ✅ **简洁的进度条**：任务条内不显示文字，保持图表简洁清晰
- ✅ **无依赖箭头**：不绘制任务依赖关系箭头，避免图表杂乱
- ✅ 支持命令行和交互式使用

## 🚀 快速开始

### 1. 基本使用

```bash
# 从文件读取并转换
python gantt_to_drawio.py -i gantt_data.txt -o output.drawio

# 从标准输入读取
python gantt_to_drawio.py -i - -o output.drawio < gantt_data.txt

# 交互式输入
python gantt_to_drawio.py
```

### 2. 在 Python 代码中使用

```python
from gantt_to_drawio import convert_gantt_to_drawio

# 甘特图表数据
gantt_text = """
任务ID	任务名称	开始时间	结束时间	工期(月)	前置任务	责任方/备注
1	项目启动	M0	M1	2		
1.1	项目立项	M0	M0+0.5	0.5		甲方、乙方
1.2	需求调研	M0+0.5	M1	0.5	1.1	乙方
"""

# 转换为 draw.io XML
xml_content = convert_gantt_to_drawio(gantt_text, "output.drawio")
print("转换完成！")
```

## 📝 输入格式说明

### 表格格式要求

输入数据应为表格格式，包含以下列（顺序可以调整）：

1. **任务ID** - 任务的唯一标识符，支持层级结构（如：1, 1.1, 1.2, 2.1等）
2. **任务名称** - 任务的描述名称
3. **开始时间** - 任务的开始时间（支持格式见下方）
4. **结束时间** - 任务的结束时间
5. **工期(月)** - 任务持续时间（可选，会自动计算）
6. **前置任务** - 依赖的任务ID，多个任务用逗号或空格分隔（可选）
7. **责任方/备注** - 任务的责任人或备注信息（可选）

### 时间格式支持

支持以下时间格式：

- `M0` - 第0个月
- `M1` - 第1个月
- `M1+0.5` - 第1.5个月
- `M1.5` - 第1.5个月
- `M10+0.5` - 第10.5个月

### 任务层级

任务层级通过任务ID的点号数量自动识别：

- `1` - 主要阶段（level 0）
- `1.1` - 二级任务（level 1）
- `1.1.1` - 三级任务（level 2）

### 依赖关系

前置任务列支持多个依赖任务，用逗号或空格分隔：

```
前置任务: 1.1, 1.2
前置任务: 2.1 2.2 2.3
```

## 📊 输出说明

### 生成的甘特图特性

1. **任务名称列** - 左侧第一列显示任务名称，根据层级自动缩进
2. **备注列** - 左侧第二列独立显示责任方/备注信息，与任务条分离，便于阅读
3. **时间轴** - 横轴显示月份刻度，根据跨度自动调整显示间隔
4. **任务条** - 彩色条形图表示任务的时间范围
   - 主要阶段：绿色，粗边框
   - 二级任务：黄色
   - 三级任务：蓝色
   - 超长任务（>12个月）：虚线边框
   - **注意**：任务条内不显示任何文字，保持简洁清晰
5. **无依赖箭头** - 不绘制任务依赖关系箭头，避免图表杂乱，保持视觉清晰

### 颜色方案

- 🟢 绿色 - 主要阶段（level 0）
- 🟡 黄色 - 二级任务（level 1）
- 🔵 蓝色 - 三级任务（level 2）
- 🟣 紫色 - 四级任务（level 3）
- 🔴 红色 - 五级任务（level 4）

## 📋 完整示例

### 输入数据示例

项目根目录提供了完整的示例数据文件 `example_gantt_data.txt`，包含26个任务的完整项目进度数据。

**快速测试：**
```bash
python gantt_to_drawio.py -i example_gantt_data.txt -o project_gantt.drawio
```

**示例数据片段：**
```
任务ID	任务名称	开始时间	结束时间	工期(月)	前置任务	责任方/备注
1	项目启动与准备阶段	M0	M1	2		
1.1	项目立项与团队组建	M0	M0+0.5	0.5		甲方、乙方
1.2	需求调研与分析	M0+0.5	M1	0.5	1.1	乙方（输出《需求分析说明书》）
1.3	技术方案与架构设计	M1	M1+0.5	0.5	1.2	乙方（输出《技术方案》等）
2	系统设计与开发阶段	M1.5	M6	4.5		
2.1	移动端（APP）开发	M1.5	M4	2.5	1.3	乙方
2.2	PC端后台系统开发	M2	M5	3	1.3	乙方
2.3	AI算法模型开发与集成	M1.5	M4.5	3	1.3	乙方
2.4	数据对接与接口开发	M3	M5	2	2.1, 2.2, 2.3	乙方、甲方配合
```

### 使用命令

```bash
# 使用项目提供的示例数据
python gantt_to_drawio.py -i example_gantt_data.txt -o project_gantt.drawio

# 使用您自己的数据
python gantt_to_drawio.py -i your_gantt_data.txt -o output.drawio
```

### 查看结果

生成的 `.drawio` 文件可以使用以下工具打开和编辑：

- [draw.io](https://app.diagrams.net/) - 在线版本
- [diagrams.net](https://www.diagrams.net/) - 桌面版本
- Visual Studio Code（安装 draw.io 扩展）

## 🔧 高级配置

### 自定义样式

可以在代码中修改以下参数来调整甘特图样式：

```python
# 在 GanttDrawIOGenerator.__init__ 中
self.month_width = 80  # 每个月的宽度（像素）
self.task_height = 30  # 每个任务条的高度
self.task_spacing = 10  # 任务之间的间距
self.label_width = 200  # 任务名称标签的宽度
```

### 处理超长任务

对于超过12个月的任务，工具会自动：
- 使用虚线边框标识
- 压缩月份宽度以避免画布过宽
- 调整时间轴刻度间隔

## ⚠️ 注意事项

1. **时间格式** - 确保时间格式正确，否则可能解析失败
2. **任务ID** - 任务ID必须唯一，前置任务ID必须存在于任务列表中
3. **文件编码** - 输入文件应使用 UTF-8 编码
4. **表格分隔符** - 支持制表符（Tab）或多个空格作为列分隔符

## 🐛 故障排除

### 问题：解析不到任务数据

**解决方案**：
- 检查表格格式是否正确
- 确保表头行包含"任务ID"或"任务名称"
- 检查文件编码是否为 UTF-8

### 问题：时间解析错误

**解决方案**：
- 检查时间格式是否符合支持的格式
- 确保开始时间小于等于结束时间

### 问题：依赖关系未显示

**解决方案**：
- 检查前置任务ID是否正确
- 确保前置任务ID存在于任务列表中
- 检查任务ID格式是否匹配

## 📄 许可证

Copyright (c) 2026 吕滢

Licensed under the MIT License (Non-Commercial) or Apache License 2.0 (Non-Commercial)
See LICENSE-MIT-NC or LICENSE-APACHE-NC for details.

This software is for NON-COMMERCIAL USE ONLY.
For commercial use, please contact the copyright holder.
