# API 超时问题解决方案

## 问题描述

调用 DeepSeek API 时出现超时错误：
```
HTTPSConnectionPool(host='api.deepseek.com', port=443): Read timed out.
```

## 已实施的解决方案

### 1. ✅ 增加超时时间
- **之前**：固定 30 秒超时
- **现在**：可配置的超时时间（默认 60 秒，可调整到 180 秒）
- 每次重试时会自动增加超时时间

### 2. ✅ 添加重试机制
- 自动重试机制（默认 3 次，可调整到 5 次）
- 指数退避策略：重试间隔为 2秒、4秒、8秒...
- 智能错误处理：区分不同类型的错误（超时、连接错误、服务器错误等）

### 3. ✅ 改进错误提示
- 更详细的错误信息
- 针对不同错误类型提供具体解决方案
- 在界面上显示当前超时和重试配置

### 4. ✅ 用户可配置选项
在侧边栏的"高级设置"中可以调整：
- **请求超时时间**：30-180 秒（默认 60 秒）
- **最大重试次数**：1-5 次（默认 3 次）

## 使用方法

### 如果遇到超时问题：

1. **打开高级设置**
   - 点击侧边栏的"⚙️ 高级设置（网络问题时可调整）"

2. **增加超时时间**
   - 将"请求超时时间"调整到 120-180 秒
   - 适用于文档内容较大或网络较慢的情况

3. **增加重试次数**
   - 将"最大重试次数"调整到 4-5 次
   - 适用于网络不稳定的情况

4. **检查网络连接**
   - 确保可以访问 `api.deepseek.com`
   - 如果使用代理，确保代理配置正确

## 技术细节

### 超时策略
- 第 1 次尝试：使用配置的超时时间（默认 60 秒）
- 第 2 次尝试：超时时间 + 20 秒
- 第 3 次尝试：超时时间 + 40 秒
- 以此类推...

### 重试策略
- 超时错误：等待 2^attempt 秒后重试
- 连接错误：等待 2^attempt 秒后重试
- 429 错误（频率限制）：等待 2^attempt 秒后重试
- 500 错误（服务器错误）：等待 2^attempt 秒后重试

### 错误处理
- **401 错误**：API 密钥无效，立即返回错误
- **429 错误**：请求频率过高，自动重试
- **500 错误**：服务器错误，自动重试
- **超时错误**：自动重试，每次增加超时时间
- **连接错误**：自动重试

## 常见问题

### Q: 仍然超时怎么办？
A: 
1. 检查网络连接是否稳定
2. 尝试增加超时时间到 180 秒
3. 减少文档内容（文档太大可能导致请求时间过长）
4. 检查是否有防火墙或代理限制

### Q: 重试太多次浪费时间？
A: 
- 可以在"高级设置"中减少重试次数
- 或者直接取消操作，检查网络后重试

### Q: 如何知道当前使用的超时和重试配置？
A: 
- 在点击"搜索答案"时，界面会显示当前的超时和重试配置
- 也可以在侧边栏的"高级设置"中查看和修改

## 更新日志

- ✅ 2024-XX-XX: 添加可配置的超时和重试机制
- ✅ 2024-XX-XX: 改进错误提示和用户指导
- ✅ 2024-XX-XX: 添加智能重试策略

